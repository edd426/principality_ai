# Playtest: CARD-006 Militia Mechanical Test

**Date**: 2025-12-22 | **Game ID**: game-1766406419718-57hvrp2il | **Turns**: 22 | **Result**: stuck (critical bugs prevent gameplay)

## Summary

Attempted to test Militia card mechanics (cost 4, +2 coins, attack effect). Game failed to allow proper gameplay due to multiple critical phase transition bugs. Militia was never reached because players could not perform buy-phase actions reliably.

## Critical Bugs Found

### BUG 1: Phase Transition Skip - Buy Phase Auto-Skipped
**Severity**: CRITICAL

The game frequently auto-skipped the buy phase entirely, jumping from action phase directly to cleanup and back to action phase on the next turn. This prevented treasures from being played and cards from being purchased.

**Evidence**:
- Turn 7 response: `{"phase":"action","turnNumber":7}` immediately after attempting to end buy phase
- Turn 9 response: `{"phase":"action","turnNumber":9}` - skipped buy phase
- Turn 12 response: `{"phase":"action","turnNumber":12}` - skipped buy phase
- Message pattern: "end_phase → Cleanup auto-skipped → action phase" with "phaseChanged":"buy → cleanup"

This indicates the cleanup phase auto-advances without respecting that a buy phase should occur.

**Impact**: Players cannot execute buy phase logic (play treasures, purchase cards). Game becomes unplayable.

### BUG 2: Turn Number Skipping/Inconsistency
**Severity**: HIGH

Turn numbers jumped unexpectedly instead of incrementing sequentially:
- Turn 5 → Turn 6 (normal)
- Turn 6 → Turn 7 (normal)
- Turn 7 → Turn 9 (SKIP +2)
- Turn 9 → Turn 12 (SKIP +3)
- Turn 13 → Turn 16 (SKIP +3)
- Turn 18 → Turn 20 (SKIP +2)
- Turn 20 → Turn 22 (SKIP +2)

**Evidence**:
- Multiple game_execute responses showed turn jumps
- game_observe responses confirmed non-sequential turn numbers

**Impact**: Turn tracking is unreliable. Game progression cannot be validated.

### BUG 3: Phase Mismatch in Response vs. State
**Severity**: HIGH

Response would report phase="buy" but subsequent game_observe or next move would show phase="action", indicating state desynchronization between move execution and game observation.

**Example**:
```json
// Move response (Turn 18)
{"phase":"buy","turnNumber":18,"phaseChanged":"action → buy"}

// Next execute attempt
{"phase":"action","turnNumber":20,"error":"Cannot play treasures in Action phase."}
```

**Impact**: Client cannot trust phase information from move responses. State is inconsistent.

### BUG 4: "Cannot play treasures in Action phase" Error During Buy Phase
**Severity**: CRITICAL

Turn 20: Received `"Cannot play treasures in Action phase."` error when attempting `play_treasure all` even though the previous response indicated `phase="buy"`.

```json
// Request (Turn 18 buy phase)
move: "play_treasure all"

// Response
{
  "success": false,
  "error": {"message": "Cannot play treasures in Action phase."},
  "gameState": {"phase": "action", "turnNumber": 20}
}
```

This directly contradicts the phase reported in the previous response.

**Impact**: Cannot play treasures when phase says "buy". Game logic is broken.

## Turn-by-Turn Log

| Turn | Phase | Hand | Coins | Action | Result |
|------|-------|------|-------|--------|--------|
| 1 | action | Copper×3, Estate×2 | 0 | end | OK → buy |
| 2-4 | (auto-cycled) | — | — | — | BUG: Auto-skipped buy |
| 5 | buy | Estate×2 | 3 | buy Silver | OK (Silver cost 3) |
| 6 | buy | Estate×1 | 1 | end | OK → cleanup |
| 7 | action | Estate×2, Copper×2, Silver×1 | 0 | end | BUG: Jumped to turn 9 |
| 9 | action | Copper×4, Estate×1 | 0 | end | BUG: Jumped to turn 12 |
| 12 | action | Copper×4, Silver×1 | 0 | end | BUG: Jumped to turn 13 |
| 13 | action | Estate×2, Copper×2 | 0 | end | BUG: Jumped to turn 16 |
| 16 | action | Copper×4, Estate×1 | 0 | end | BUG: Jumped to turn 18 |
| 18 | buy | Copper×3, Estate×2 | 0 | play_treasure all | ERROR: "Cannot play treasures in Action phase" |
| 20 | action | Copper×3, Estate×2 | 0 | end | OK → buy (phase recovered) |
| 22 | buy | Estate×3, Copper×2 | 0 | (stopped) | Game ended due to turn limit |

## Militia Card Status

**Never reached**: Militia (cost 4) was never purchased or played.

- Militia was available in supply (10 remaining at all times)
- Player only accumulated enough coins for Silver (cost 3) purchases
- Could not progress to cost 4 cards due to phase bugs preventing reliable treasure plays and purchases

### What Should Have Happened (Expected)
1. Play treasures → accumulate 4+ coins
2. Buy Militia (cost 4)
3. Militia enters hand in future turn
4. Play Militia → receive +2 coins (verify coin increase)
5. Militia attack: other players discard down to 3 cards (solo mode may skip)

### What Actually Happened
1. Game stuck in action phase loops
2. Buy phase frequently skipped
3. Turn numbers jumped unpredictably
4. Militia was never affordable or purchasable

## Observations

- The game log shows treasures WERE played in some turns (e.g., "Player 1 played Copper" × 5 on Turn 12), but the state display did not reflect this properly
- The coin count never increased above 3 (when Silver was purchased), indicating treasures were not generating coins in the buy phase despite logs showing they were played
- Supply was properly initialized with Militia (10 cards available)
- No errors in game initialization (seed worked, kingdom cards selected correctly)

## UX Issues

1. **Inconsistent phase reporting**: Response phase doesn't match subsequent state
2. **Silent buy phase skips**: No error message, phase just auto-advances
3. **Confusing turn jumps**: No explanation for why turns skip numbers
4. **Contradiction between logs and state**: Game log shows treasure plays, but coins not updated in state

## Recommendations

1. **Fix phase transition logic**: Ensure buy phase is not auto-skipped
2. **Add phase validation**: Verify phase consistency before executing moves
3. **Debug turn numbering**: Track why turns are being incremented more than once per move
4. **Add error handling**: If phase mismatch detected, return clear error instead of silent failures
5. **Sync state updates**: Ensure all state changes (coins, turn number, phase) are atomic and consistent

## Test Status

**FAILED** - Could not complete Militia mechanics test due to foundational game engine bugs. Recommend fixing phase transition and turn numbering before retrying CARD-006 test.
