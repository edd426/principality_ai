# Playtest: CARD-006 - Witch Attack + Curses

**Date**: 2025-12-23 | **Game ID**: game-1766469806179-5ijwcs13i | **Turns**: 20 | **Result**: INCOMPLETE - Test Aborted

---

## Summary

Test could not be completed as requested because: (1) Witch card is NOT available in the kingdom cards for seed "witch-test-1", and (2) critical buy phase execution bug prevents any card purchases from occurring. The game has a serious phase management issue where the buy phase is being skipped or the player is unable to execute buy moves even when in the correct phase.

---

## Test Setup

| Property | Value |
|----------|-------|
| Seed | witch-test-1 |
| Edition | 2E (attempted) |
| Game Mode | Solo (1 player) |
| Target Card | Witch (NOT FOUND) |
| Turns Completed | 20 |

---

## Kingdom Cards Loaded

The following 10 kingdom cards were loaded (instead of expected Witch):

1. Laboratory (5 cost, +2 cards, +1 action)
2. Village (3 cost, +1 card, +2 actions)
3. Throne Room (4 cost, play card twice)
4. Council Room (5 cost, +4 cards, +1 buy)
5. Smithy (4 cost, +3 cards)
6. Chapel (2 cost, trash up to 4)
7. Mine (5 cost, upgrade treasure)
8. Bureaucrat (4 cost, attack - gain Silver to deck)
9. Festival (5 cost, +2 actions, +1 buy, +1 coin)
10. Moneylender (4 cost, trash Copper for +1 coin)

**Note**: Witch card was NOT in any of the selected kingdom cards.

---

## Curse Pile Status

The Curse pile WAS available in the supply:
- **Initial**: 10 Curses
- **Final**: 10 Curses (unchanged)
- **Trades**: No Curses were distributed (no attack cards triggered Curse distribution)

---

## Critical Bug Discovered: Buy Phase Execution Failure

### Symptom
Player cannot execute buy moves even when validMoves includes "buy" options.

### Reproduction Steps

1. Start game
2. Progress to turn where player reaches buy phase
3. Player in buy phase with treasures in hand
4. Execute `play_treasure all`
5. **Expected**: Treasures are played, coins added, player can buy
6. **Actual**: Game immediately reverts to action phase with error "Cannot play treasures in Action phase"

### Example from Turn 5

```
Turn 5 - Action Phase
→ execute "end"
RESPONSE: phase="buy", validMoves includes "play_treasure"

Turn 5 - Buy Phase
→ execute "play_treasure all"
RESPONSE: ERROR - "Cannot play treasures in Action phase", phase reverted to "action"
```

### Error Details

From Turn 3 attempt:
```json
{
  "success": false,
  "error": {
    "message": "Cannot play treasures in Action phase.",
    "suggestion": "Use \"end\" to move to Buy phase first, then play treasures."
  },
  "gameState": {
    "phase": "action",  // ← REVERTED FROM BUY
    "turnNumber": 4
  }
}
```

### Impact
- **Severity**: CRITICAL
- **Effect**: No purchases can be made. Game is unplayable.
- **Reproducibility**: Consistent - occurs every time treasures are played in buy phase

---

## Turn Log

| Turn | Action | Result | Phase After |
|------|--------|--------|-------------|
| 1 | end | Cleanup skipped | action |
| 2 | end | Phase: buy | buy |
| 3 | end (action) | Phase: buy | buy |
| 3 | play_treasure all | ERROR - reverted to action | action |
| 4 | end | Cleanup skipped | action |
| 5 | end | Phase: buy | buy |
| 5 | play_treasure all | ERROR - reverted to action | action |
| 6-20 | end (repeated) | Alternating cleanup skip | action |

---

## Bugs Found

### BUG #1: Witch Card Missing from Seed
- **Severity**: HIGH (Test prerequisite failure)
- **Description**: Seed "witch-test-1" does not include Witch card in kingdom selection
- **Expected**: Witch should be available in supply
- **Actual**: Witch not in selectedKingdomCards array
- **Workaround**: Manually create seed that includes Witch, or provide correct seed name

### BUG #2: Buy Phase Execution Failure (CRITICAL)
- **Severity**: CRITICAL
- **Description**: After transitioning to buy phase and calling `play_treasure all`, game reverts to action phase with error message saying "Cannot play treasures in Action phase"
- **Expected**: Treasures are played, coins are added, buy moves become available
- **Actual**: Game state reverts to action phase, error is thrown, no coins are generated
- **Affected Move**: `play_treasure all` and `play_treasure [CardName]` in buy phase
- **Reproducibility**: 100% - happens every attempt
- **Impact**: No purchases can be executed, game is unplayable
- **Location**: Phase management logic in MCP server or game engine

### BUG #3: Curse Pile Not Tested
- **Severity**: MEDIUM (Cannot test without Witch or other attack cards)
- **Description**: Curse distribution mechanics could not be verified because no attack cards were available to trigger curse distribution
- **Expected**: With Witch available, playing Witch would give opponent Curse cards
- **Actual**: No attack mechanics triggered, Curse pile remained at 10

---

## UX Issues & Suggestions

### UX #1: Confusing Phase Error Messages
- When in buy phase and playing treasures causes reversion to action phase, the error message says "Cannot play treasures in Action phase" which is misleading
- **Suggestion**: Error message should clarify the actual problem (e.g., "Phase management error: treasure play caused unexpected phase change")

### UX #2: No Buy Phase Move Validation
- `validMoves` shows "buy" and "play_treasure" as available, but executing them causes errors
- **Suggestion**: Fix underlying phase logic so validMoves accurately reflects what moves will actually succeed

---

## Test Outcome

**RESULT**: FAILED

**Reasons**:
1. Witch card not available in kingdom selection
2. Critical buy phase bug prevents any gameplay progression beyond turn 20
3. Curse distribution mechanics could not be tested

**Recommendation**:
- Fix BUG #2 (buy phase execution) as critical blocker
- Verify correct seed for Witch card availability
- Re-run test with fixes applied

---

## Game Log (Final 10 Turns)

```
Turn 11 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 12 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 13 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 14 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 15 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 16 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 17 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 18 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 19 begins
Player 1 ended action phase
Player 1 ended buy phase
Turn 20 begins
Player 1 ended action phase
```

---

## Conclusion

The test revealed a **critical blocker** in the MCP server's buy phase implementation. The phase management logic appears to have a state reversion bug where playing treasures in the buy phase causes an immediate revert to the action phase. This prevents any game progression beyond rudimentary action phase ending.

Additionally, the seed "witch-test-1" does not include the Witch card, making the specific test scenario impossible to execute.

**Next Steps**:
1. Fix buy phase state management bug (Priority: CRITICAL)
2. Verify seed parameter for Witch card inclusion
3. Add unit tests for buy phase treasure playing
4. Re-run test with fixes applied
