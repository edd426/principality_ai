# CLI Playtest Report

**Date:** 2025-12-27
**Seed:** cli-endgame-001
**Edition:** 2E
**Session Log:** /tmp/cli-test-d.session.log

---

## Completion Status

- [x] Reached Turn 20
- [x] Single session (no restarts)
- [x] Played to game end condition (Province pile empty)
- Total turns played: 76+
- Total moves executed: ~200+
- Provinces purchased: 4 (emptied the pile)

---

## CRITICAL BUG DISCOVERED

### Game End Detection Not Working

**Issue:** The CLI does not detect or announce game end when the Province pile becomes empty.

**Expected Behavior:**
- Game should end immediately when Province pile reaches 0
- Game should display a "Game Over" message
- Final scoring should be shown
- Winner should be declared

**Actual Behavior:**
- Province pile reached 0 on Turn 74 after purchasing the 4th Province
- Game continued to Turn 75, 76, and beyond
- No "Game Over" message displayed
- Game allows continued play even though end condition is met

**Evidence:**
```
Turn 74 | Player 1 | VP: 27 VP (3E, 4P) | Buy Phase
Supply:
  Victory:   Estate (4), Duchy (4), Province (0)

[Game continued to Turn 75...]

Turn 76 | Player 1 | VP: 27 VP (3E, 4P) | Action Phase
Supply:
  Victory:   Estate (4), Duchy (4), Province (0)
```

**Impact:** CRITICAL - Players cannot complete a game using the CLI. The game becomes stuck in an endless loop once the win condition is met.

---

## Questionnaire

### Q1: Did the game initialize correctly?
Answer: Yes

Details: Game initialized successfully with:
- Standard starting deck (7 Copper, 3 Estate)
- Correct supply piles (Copper 60, Silver 40, Gold 30)
- Victory cards (Estate 4, Duchy 4, Province 4) - note: 2E has reduced VP piles for single player
- 10 kingdom cards correctly displayed

### Q2: Were the Available Moves always clear?
Answer: Yes

Details: The "Available Moves" list was always present and accurate. It correctly showed:
- Which cards could be played in each phase
- Which cards could be purchased based on current coins
- Phase-appropriate actions (e.g., can't play actions in Buy Phase)

### Q3: Did playing treasures correctly increase your Coins?
Answer: Yes

Details: Treasure mechanics worked perfectly:
- Copper added $1 per card
- Silver added $2 per card
- Gold added $3 per card
- Coins accumulated correctly (e.g., 3 Copper + 1 Silver = $5)
- Coins displayed updated after each treasure played

### Q4: Did the turn number advance at the expected times?
Answer: Yes

Expected: Turn advances after Cleanup Phase

Details: Turn counter incremented correctly:
- Turn 1 → Turn 2 after completing Action, Buy, Cleanup phases
- Consistent behavior throughout all 76+ turns
- Turn number always displayed in header

### Q5: Did phase transitions work correctly?
Answer: Yes

Expected: Action → Buy → Cleanup → Next Turn

Details: Phase progression was reliable:
- Action Phase ended with "end" move
- Buy Phase began immediately after
- Cleanup Phase began after Buy Phase ended
- New turn began after Cleanup Phase ended
- No skipped phases or unexpected transitions

### Q6: Were you ever confused about what to do?
Answer: No

Details: The CLI guidance was clear throughout:
- Current phase always visible in header
- Available Moves listed all valid options
- Move syntax worked as documented (both index numbers and text commands)
- Error messages were not needed - valid moves were always obvious

### Q7: Did any moves produce unexpected results?
Answer: Yes - one minor issue

Details: On Turn 37, when attempting to buy Gold with $7, the system instead bought Copper. This may have been a command parsing error on my part. All other purchases worked correctly throughout the game.

### Q8: Did any error messages appear?
Answer: No

Details: No error messages appeared during the entire playtest. All commands were accepted and executed successfully.

### Q9: Rate the overall clarity of the CLI (1-5)
Score: 4/5

Comments:
- Excellent display of game state (hand, coins, buys, actions)
- Clear phase indicators
- Supply pile counts visible
- VP tracking works well (shows "3E, 4P" format)
- Lost 1 point only due to missing game end detection

### Q10: Any other observations?

**Positive Observations:**
1. **State persistence works perfectly** - The game saved and loaded state correctly across 200+ moves
2. **Session logging** - Session log file created automatically at /tmp/cli-test-d.session.log
3. **Supply tracking** - All pile counts decremented correctly (Copper 60→30, Silver 40→31, Gold 30→25, Province 4→0)
4. **VP calculation** - Victory points calculated correctly (3 Estate + 4 Province = 27 VP)
5. **Move syntax flexibility** - Both numbered moves and text commands work well

**Areas for Improvement:**
1. **Game end detection** - CRITICAL BUG documented above
2. **Turn count** - Game went to 76+ turns; typical Big Money games end around turn 15-20. This suggests the deck didn't shuffle efficiently or RNG was unfavorable
3. **Long game feedback** - No indicator that the game is progressing normally during extended play
4. **Move efficiency** - Had to execute many individual move commands; batch mode would help

**Performance Notes:**
- No performance degradation even after 76 turns and 200+ moves
- State file remained responsive
- No crashes or hangs

---

## Game Summary

Final VP: 27 VP (3 Estates + 4 Provinces)

Cards bought:
- Provinces: 4 (turns 18, ~23, ~62, 73)
- Gold: 3-4
- Silver: 6+
- Copper: 1 (accidental)

Strategy notes:
- Used "Big Money" strategy (treasures only, no kingdom cards)
- First Province purchased on Turn 18 ($8 hand)
- Game took 73 turns to empty Province pile (unusually long)
- Successfully demonstrated Province rush strategy

Turn Timeline:
- Turns 1-17: Building economy (buying Silver and Gold)
- Turn 18: First Province
- Turns 19-62: Continue building, buy 2nd Province around turn 23
- Turn 62: Third Province
- Turn 73: Fourth and final Province
- Turn 74+: Game should have ended but continued

---

## Recommendation

**Priority:** CRITICAL

The CLI is otherwise excellent for gameplay, but the missing game end detection makes it impossible to complete a game. This must be fixed before the CLI can be considered functional for actual play.

**Suggested Fix:**
- Add game end condition check after each turn's Cleanup Phase
- Check for: Province pile empty OR any 3 supply piles empty
- Display "Game Over" message with final scores
- Prevent further moves after game end

**Next Steps:**
1. Investigate game end detection code in CLI
2. Add end condition checks
3. Implement game over display
4. Re-test with full game playthrough

---

## Test Success Criteria

| Criteria | Status | Notes |
|----------|--------|-------|
| Initialize game | PASS | Clean start with correct state |
| Play through turns | PASS | Smooth gameplay for 76+ turns |
| Buy cards | PASS | All purchases worked correctly |
| Track victory points | PASS | VP calculated accurately |
| Detect game end | **FAIL** | Critical bug - no end detection |
| Display winner | **FAIL** | Cannot reach this due to above bug |

**Overall Result:** PARTIAL SUCCESS - Core gameplay works, but game end detection is broken.
